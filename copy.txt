const db = require("../config/db");

const OrderModel = {
  // Lưu đơn hàng
  async createOrder(userId, items) {
    const totalAmount = items.reduce((sum, item) => sum + item.price * item.quantity, 0);
    
    // Tạo đơn hàng mới
    const [order] = await db.query(
      "INSERT INTO orders (user_id, total_amount) VALUES (?, ?)",
      [userId, totalAmount]
    );

    // Thêm các sản phẩm vào đơn hàng
    for (const item of items) {
      await db.query(
        "INSERT INTO order_items (order_id, product_id, product_type, name, price, quantity, avartar) VALUES (?, ?, ?, ?, ?, ?, ?)",
        [order.insertId, item.productId, item.productType, item.name, item.price, item.quantity, item.avartar]
      );
    }

    return order.insertId; // Trả về ID của đơn hàng mới tạo
  }
};

module.exports = OrderModel;




CREATE TABLE orders (
  id INT PRIMARY KEY AUTO_INCREMENT,
  user_id INT NOT NULL,
  total_price DECIMAL(10,2) NOT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  status VARCHAR(50) DEFAULT 'pending'
);

CREATE TABLE order_items (
  id INT PRIMARY KEY AUTO_INCREMENT,
  order_id INT NOT NULL,
  product_type VARCHAR(50) NOT NULL, -- 'camera', 'hardware', 'software'
  product_id INT NOT NULL,
  name VARCHAR(255) NOT NULL,         -- Tên sản phẩm tại thời điểm đặt
  avartar VARCHAR(255),               -- Ảnh sản phẩm
  quantity INT NOT NULL,
  price DECIMAL(10,2) NOT NULL,       -- Giá tại thời điểm đặt
  FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE
);



