const db = require("../config/db");

const ProductModel = {
  getAll: () => {
    return db.query("SELECT * FROM products");
  },

  getByType: (type) => {
    return db.query("SELECT * FROM products WHERE type = ?", [type]);
  },

  getById: (id, type) => {
    return db.query("SELECT * FROM products WHERE id = ? AND type = ?", [id, type])
      .then(([rows]) => rows[0]);
  },

  create: (product) => {
    return db.query("INSERT INTO products SET ?", product);
  },

  update: (id, product) => {
    return db.query("UPDATE products SET ? WHERE id = ?", [product, id]);
  },

  remove: (id) => {
    return db.query("DELETE FROM products WHERE id = ?", [id]);
  },

  getHighlighted: async () => {
    const [rows] = await db.query(`
      (
        SELECT * FROM products 
        WHERE type = 'cameras' 
        ORDER BY created_at DESC 
        LIMIT 3
      )
      UNION ALL
      (
        SELECT * FROM products 
        WHERE type = 'softwares' 
        ORDER BY created_at DESC 
        LIMIT 3
      )
      UNION ALL
      (
        SELECT * FROM products 
        WHERE type = 'hardwares' 
        ORDER BY created_at DESC 
        LIMIT 3
      )
    `);

    const grouped = { cameras: [], softwares: [], hardwares: [] };
    rows.forEach((p) => grouped[p.type]?.push(p));
    return grouped;
  },
};

module.exports = ProductModel;
